<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gallery</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --ink:#0f172a;
            --muted:#64748b;
            --accent:#0ea5a4;
            --ring:#e2e8f0;
        }
        body{
            margin:0;
            font-family:"Space Grotesk", system-ui, -apple-system, sans-serif;
            color:var(--ink);
            background:
              radial-gradient(900px 500px at 10% -10%, #dff7ff 0%, transparent 55%),
              radial-gradient(900px 600px at 110% -10%, #f2e9ff 0%, transparent 55%),
              linear-gradient(180deg,#eef6fb,#ffffff 45%,#f7f3ff);
        }
        .wrap{
            max-width:1100px;
            margin:36px auto 64px;
            padding:0 20px;
        }
        .hero{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:16px;
            background:#ffffff;
            border:1px solid var(--ring);
            border-radius:16px;
            padding:22px 24px;
            box-shadow:0 18px 40px rgba(2,6,23,0.08);
        }
        h1{margin:0;font-size:2.2rem}
        p{margin:6px 0 0;color:var(--muted)}
        .empty{
            margin-top:18px;
            background:#ffffff;
            border:1px dashed var(--ring);
            border-radius:14px;
            padding:28px;
            text-align:center;
            color:var(--muted);
        }
        .cta{
            display:inline-block;
            margin-top:12px;
            padding:10px 14px;
            border-radius:9px;
            background:var(--accent);
            color:white;
            text-decoration:none;
        }
        .grid{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
            gap:16px;
            margin-top:18px;
        }
        .shot{
            background:#ffffff;
            border:1px solid var(--ring);
            border-radius:14px;
            overflow:hidden;
            box-shadow:0 12px 24px rgba(2,6,23,0.08);
            display:flex;
            flex-direction:column;
        }
        .shot img{
            width:100%;
            height:220px;
            object-fit:cover;
            display:block;
        }
        .shot figcaption{
            padding:12px 14px;
            color:var(--muted);
        }
        .lightbox{
            position:fixed;
            inset:0;
            background:rgba(15,23,42,0.75);
            display:none;
            align-items:center;
            justify-content:center;
            padding:24px;
            z-index:20000;
        }
        .lightbox.open{display:flex}
        .lightbox img{
            max-width:min(100%,1000px);
            max-height:85vh;
            border-radius:16px;
            box-shadow:0 24px 60px rgba(2,6,23,0.4);
            background:#fff;
        }
        .lightbox .caption{
            color:#e2e8f0;
            margin-top:12px;
            text-align:center;
        }
    </style>
</head>
<body>
    <script src="global-nav.js"></script>
    <script src="chatuser.js"></script>

    <main class="wrap">
        <section class="hero">
            <div>
                <h1>Gallery</h1>
                <p>New work drops here first.</p>
            </div>
        </section>

        <section class="empty" aria-live="polite" id="galleryEmpty">
            <h2>No images yet</h2>
            <p>Check back soon for new shots. If you need access now, reach out.</p>
            <a class="cta" href="contact.html">Contact Mason</a>
        </section>
        <section class="grid" id="galleryGrid" style="display:none" aria-label="gallery"></section>
        <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Image preview">
            <div>
                <img id="lightboxImg" alt="Gallery preview" />
                <div id="lightboxCaption" class="caption"></div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
    <script>
        (async () => {
            const SUPABASE_URL = 'https://hyehyfbnskiybdspkbxe.supabase.co';
            const SUPABASE_ANON_KEY = 'sb_publishable_Spz2O3ITj_9Q7cT84pKG6w_2h4yOFyu';
            if (typeof supabase === 'undefined') return;
            const sb = window.msSupabase || (window.msSupabase = supabase.createClient(
                SUPABASE_URL,
                SUPABASE_ANON_KEY,
                { auth: { persistSession: true, autoRefreshToken: true, storageKey: 'mason_auth', storage: window.localStorage } }
            ));

            const grid = document.getElementById('galleryGrid');
            const empty = document.getElementById('galleryEmpty');
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightboxImg');
            const lightboxCaption = document.getElementById('lightboxCaption');

            async function loadGallery() {
                const { data } = await sb
                    .from('gallery_images')
                    .select('*')
                    .order('sort_order', { ascending: true })
                    .order('created_at', { ascending: true });
                if (!data || data.length === 0) {
                    grid.style.display = 'none';
                    empty.style.display = '';
                    return;
                }
                empty.style.display = 'none';
                grid.style.display = 'grid';
                grid.innerHTML = '';
                data.forEach((img) => {
                    const fig = document.createElement('figure');
                    fig.className = 'shot';
                    fig.innerHTML = `
                        <img src="${img.public_url}" alt="${img.caption || 'Gallery image'}" loading="lazy">
                        ${img.caption ? `<figcaption>${img.caption}</figcaption>` : ''}
                    `;
                    fig.addEventListener('click', () => {
                        if (!lightbox || !lightboxImg) return;
                        lightboxImg.src = img.public_url;
                        lightboxImg.alt = img.caption || 'Gallery image';
                        if (lightboxCaption) lightboxCaption.textContent = img.caption || '';
                        lightbox.classList.add('open');
                    });
                    grid.appendChild(fig);
                });
            }

            loadGallery();

            lightbox?.addEventListener('click', () => {
                lightbox.classList.remove('open');
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') lightbox?.classList.remove('open');
            });
        })();
    </script>
</body>
</html>
